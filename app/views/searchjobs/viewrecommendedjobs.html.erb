<div id="user_nav">

  <% if current_jobseeker%>
      Logged in as <%= current_jobseeker.username %>.
      <%= link_to "Log out", jobseeker_log_out_path %>

  <% end %>

</div>

<h1>Listing jobs</h1>

<table>
  <thead>
  <tr>
    <th>Title</th>
    <th>Description</th>
    <th>Application deadline</th>
    <th colspan="3"></th>
  </tr>
  </thead>

  <tbody>

  <% @tags = Tag.find_by_sql("select DISTINCT tag from tags where jobs_id in(select job_id from jobapplications where jobseeker_id = #{session[:user_id]})") %>
  <% @tags.each do |tag| %>

  <% @jobs = Job.find_by_sql("select DISTINCT * from jobs where id in (select jobs_id from tags where tag LIKE '%#{tag.tag}%')
EXCEPT
select * from jobs where id in (select job_id from jobapplications where jobseeker_id = #{session[:user_id]})") %>
      <% @jobs.each do |job| %>
      <tr>
        <td><%=job.title %></td>
        <td><%= job.description %></td>
        <td><%= job.application_deadline %></td>
        <td><%= link_to 'Apply', apply_job_path(job) %></td>
      </tr>
  <% end %>
  <% end %>
  </tbody>
</table>

<br>

<%= link_to 'Back', main_page_path %>
